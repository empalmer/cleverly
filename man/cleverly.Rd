% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cleverly-package.R, R/cleverly.R
\name{cleverly}
\alias{cleverly}
\title{Cleverly: Main Function of the Package}
\usage{
cleverly(
  Y,
  Z,
  subject_ids,
  time,
  lp = 0,
  response_type = "counts",
  cor_str = "IND",
  gammas,
  psi_min = 500,
  psi_max = 1500,
  npsi = 10,
  parralel = FALSE,
  nworkers = 2,
  tau = 0.005,
  theta = 500,
  C = 100,
  d = 2,
  nknots = 3,
  order = 3,
  epsilon_b = 0.001,
  epsilon_r = 0.001,
  epsilon_d = 0.001,
  epsilon_2 = 0.001,
  run_min = 3,
  max_outer_iter = 30,
  max_admm_iter = 100,
  max_2_iter = 100,
  BIC_type = "refit"
)
}
\arguments{
\item{Y}{A data frame or matrix of count response variables. Each column should represent a response variable, and each row a subject-time observation. Must be ordered by time. Total number of rows is \eqn{M}. Make sure Y counts are not transformed to RA or rarified.}

\item{Z}{A data frame or matrix containing external variables. Must have \eqn{M} rows and \eqn{L} columns.}

\item{subject_ids}{A vector of subject identifiers (length \eqn{M}) or a column name/index if \code{Y} is a data frame.}

\item{time}{A numeric vector of time points (length \eqn{M}) or a column name/index if \code{Y} is a data frame.}

\item{lp}{Either a numeric index or name of the column in \code{Z} used for clustering. Use 0 to indicate baseline clustering.}

\item{response_type}{Type of response variable. Should be either \code{"Counts"} or \code{"Continuous"}.}

\item{cor_str}{Correlation structure to use. One of \code{"IND"}, \code{"CON"}, \code{"AR1"}, \code{"CON-d"}, or \code{"AR1-d"}.}

\item{gammas}{A numeric vector of length \eqn{L + 1} specifying penalties applied to the D matrix.}

\item{psi_min}{Minimum \eqn{\psi} value (or the only value, if \code{npsi = 1}).}

\item{psi_max}{Maximum \eqn{\psi} value (ignored if \code{npsi = 1}).}

\item{npsi}{Number of \eqn{\psi} values to evaluate. If greater than 1, an equally spaced sequence from \code{psi_min} to \code{psi_max} is generated and the optimal value is selected via BIC.}

\item{parralel}{Logical; whether to use parallelization. Defaults to \code{FALSE}. If \code{TRUE}, uses \code{future::plan(future::multisession)}.}

\item{nworkers}{Number of workers to use if \code{parralel = TRUE}.}

\item{tau}{MCP hyperparameter. Default is \code{8/100}.}

\item{theta}{ADMM hyperparameter. Default is \code{300}.}

\item{C}{Constant controlling the Hessian update threshold. Default is \code{100}.}

\item{d}{Order of the finite difference matrix.}

\item{nknots}{Number of knots in the B-spline basis.}

\item{order}{Order of the B-spline basis.}

\item{epsilon_b}{Tolerance for convergence of Algorithm 1.}

\item{epsilon_r}{Tolerance for ADMM convergence (residual).}

\item{epsilon_d}{Tolerance for ADMM convergence (dual).}

\item{epsilon_2}{Tolerance for convergence of Algorithm 2.}

\item{run_min}{Minimum number of runs for stability.}

\item{max_outer_iter}{Maximum number of iterations for the outer loop (Algorithm 1).}

\item{max_admm_iter}{Maximum number of iterations for the ADMM clustering step (Algorithm 3).}

\item{max_2_iter}{Maximum number of iterations for Algorithm 2 (per outer iteration).}
}
\value{
A list with the following components:
\describe{
\item{clusters}{Final cluster assignments.}
\item{possible_clusters}{Cluster assignments for all tested \eqn{\psi} values.}
\item{chosen_psi}{Optimal \eqn{\psi} value selected via BIC.}
\item{y_hat_init}{Initial fitted values.}
\item{y_hat}{Final fitted values.}
}
}
\description{
Runs the Cleverly algorithm over a range of \eqn{\psi} values and selects the optimal one based on BIC.
}
\examples{
\dontrun{
result <- cleverly(
  Y = my_data[, c("response1", "response2")],
  Z = my_covariates,
  subject_ids = my_data$subject_id,
  time = my_data$time,
  lp = 1,
  response_type = "Counts",
  cor_str = "AR1",
  gammas = rep(1, ncol(my_covariates) + 1),
  psi_min = 0.1,
  psi_max = 1,
  npsi = 5,
  parralel = TRUE,
  nworkers = 4
)
}
}
